zabbix_export:
  version: '5.2'
  date: '2021-06-04T11:22:57Z'
  groups:
    -
      name: Templates/Modules
    -
      name: 'Templates Huawei'
  templates:
    -
      template: 'Template Optical Modules Huawei'
      name: 'Template Optical Modules Huawei'
      groups:
        -
          name: Templates/Modules
        -
          name: 'Templates Huawei'
      discovery_rules:
        -
          name: 'Network Optical Modules Multi Lane'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.47.1.1.1.1.8,{#IFTYPE},1.3.6.1.2.1.47.1.1.1.1.2,{#IFNAME},1.3.6.1.2.1.47.1.1.1.1.7, {#TEMPERATURE},1.3.6.1.4.1.2011.5.25.31.1.1.3.1.5]'
          key: net.optical.ml.discovery
          filter:
            evaltype: FORMULA
            formula: 'A and B or C and B'
            conditions:
              -
                macro: '{#IFNAME}'
                value: 40GE
                formulaid: A
              -
                macro: '{#IFNAME}'
                value: 100GE
                formulaid: C
              -
                macro: '{#TEMPERATURE}'
                value: '-255'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          lifetime: 1d
          item_prototypes:
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Lane0'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.32.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Rx Power Linha 0'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \1
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
                      
                      
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Lane1'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.32.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Rx Power Linha 1'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \2
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Lane2'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.32.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Rx Power Linha 2'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \3
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Lane3'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.32.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Rx Power Linha 3'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \4
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Lane0'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.33.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneTxPowerMLLane0[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Tx Power na Linha 0'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \1
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Lane1'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.33.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneTxPowerMLLane1[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Tx Power Linha 1'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \2
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Lane2'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.33.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneTxPowerMLLane2[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Tx Power Linha 2'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \3
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Lane3'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.33.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneTxPowerMLLane3[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Tx Power Linha 3'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      var split = value.split(',');
                      split = split.map(Number);
                      value = split;
                      return value;
                -
                  type: REGEX
                  parameters:
                    - '([^\,\s]*),([^\,\s]*),([^,\s]*),([^,\s]*)'
                    - \4
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower High Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.14.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxHighThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite alto do RxPower'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower High Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.21.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxHighWarnThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite alto de alerta do RxPower'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Low Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.13.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxLowThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite baixo para Rx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Low Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.20.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxLowWarnThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite de alerta baixo para RX power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: Temperature'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.5.{#SNMPINDEX}'
              key: 'hwEntityOpticalTemperatureML[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: ºC
              description: Temperatura
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              trigger_prototypes:
                -
                  expression: |
                    {last()}
                    >=
                    {$TRANSCEIVER_TEMP_WARN}
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: |
                    {last()}
                    <
                    {$TRANSCEIVER_TEMP_WARN}
                  name: 'High Temperature on Optical Module ML: {#IFNAME}'
                  priority: HIGH
                  description: |
                    Temperature on Optical Module more than {$TRANSCEIVER_TEMP_WARN}
                    Last value: {ITEM.LASTVALUE1}.
                  manual_close: 'YES'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower High Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.16.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxHighThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite alto para TX Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower High Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.23.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxHighWarnThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite Alto de alerta para Tx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Low Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.15.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxLowThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite baixo para Tx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Low Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.22.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxLowWarnThresholdML[{#SNMPINDEX}]'
              delay: 30m
              history: 30d
              value_type: FLOAT
              units: dBm
              description: 'Limite baixo de alerta para Tx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: Vendor Name'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.24.{#SNMPINDEX}'
              key: 'hwEntityOpticalVenderNameML[{#SNMPINDEX}]'
              delay: 1h
              history: 30d
              trends: '0'
              value_type: TEXT
              description: 'Fabricante do cabo'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
            -
              name: 'Optical Module Interface {#IFNAME}: Type'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.25.{#SNMPINDEX}'
              key: 'hwEntityOpticalVenderPnML[{#SNMPINDEX}]'
              delay: 1h
              history: 30d
              trends: '0'
              value_type: TEXT
              description: 'Tipo do Cabo'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface {#IFNAME}'
          trigger_prototypes:
            -
              expression: |
                (({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}].last()}) 
                 <= 
                ({Template Optical Modules Huawei:hwEntityOpticalRxLowWarnThresholdML[{#SNMPINDEX}].last()}))
                
                and
                
                (({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}].last()})
                <> -40)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                (({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}].last()}) 
                 >
                ({Template Optical Modules Huawei:hwEntityOpticalRxLowWarnThresholdML[{#SNMPINDEX}].last()}))
                
                and
                
                (({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}].last()})
                <> -40)
              name: 'Low Rx Signal on Optical Module ML: {#IFNAME}'
              priority: DISASTER
              description: |
                Rx Signal is low.
                Last value: {ITEM.LASTVALUE1}.
              manual_close: 'YES'
            -
              expression: |
                (({Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane3[{#SNMPINDEX}].last()}) 
                 <= 
                ({Template Optical Modules Huawei:hwEntityOpticalTxLowWarnThresholdML[{#SNMPINDEX}].last()}))
                
                and
                
                (({Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane3[{#SNMPINDEX}].last()}) 
                <> -40)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                (({Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane3[{#SNMPINDEX}].last()}) 
                 >
                ({Template Optical Modules Huawei:hwEntityOpticalTxLowWarnThresholdML[{#SNMPINDEX}].last()}))
                
                and
                
                (({Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane0[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane1[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane2[{#SNMPINDEX}].last()} or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneTxPowerMLLane3[{#SNMPINDEX}].last()}) 
                <> -40)
              name: 'Low Tx Signal on Optical Module ML: {#IFNAME}'
              priority: DISASTER
              description: |
                Low Tx Signal.
                Last value: {ITEM.LASTVALUE1}.
              manual_close: 'YES'
            -
              expression: |
                (({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}].change()} <= {$ATTENUATIONFACTOR}) 
                or
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}].change()} <= {$ATTENUATIONFACTOR}) 
                or
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}].change()} <= {$ATTENUATIONFACTOR}) 
                or
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}].change()} <= {$ATTENUATIONFACTOR}))
                
                and
                
                (({Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}].last()} 
                or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}].last()} 
                or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}].last()} 
                or
                 {Template Optical Modules Huawei:hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}].last()})
                <> -40)
              recovery_mode: NONE
              name: 'Signal Atenuation on Optical Module ML: {#IFNAME}'
              status: DISABLED
              discover: NO_DISCOVER
              priority: HIGH
              manual_close: 'YES'
          graph_prototypes:
            -
              name: 'Optical Module Interface {#IFNAME}: Rx Signals'
              graph_items:
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 59DF00
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalRxHighThresholdML[{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: FF0000
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneRxPowerMLLane0[{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: 0040FF
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneRxPowerMLLane1[{#SNMPINDEX}]'
                -
                  sortorder: '4'
                  color: FFFF00
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneRxPowerMLLane2[{#SNMPINDEX}]'
                -
                  sortorder: '5'
                  color: BF00FF
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneRxPowerMLLane3[{#SNMPINDEX}]'
                -
                  sortorder: '6'
                  drawtype: BOLD_LINE
                  color: CC6600
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalRxLowThresholdML[{#SNMPINDEX}]'
            -
              name: 'Optical Module Interface {#IFNAME}: Temperature'
              graph_items:
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: FF0000
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalTemperatureML[{#SNMPINDEX}]'
            -
              name: 'Optical Module Interface {#IFNAME}: Tx Signals'
              graph_items:
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 59DF00
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalTxHighThresholdML[{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: FF0000
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneTxPowerMLLane0[{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: 0040FF
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneTxPowerMLLane1[{#SNMPINDEX}]'
                -
                  sortorder: '4'
                  color: FFFF00
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneTxPowerMLLane2[{#SNMPINDEX}]'
                -
                  sortorder: '5'
                  color: BF00FF
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneTxPowerMLLane3[{#SNMPINDEX}]'
                -
                  sortorder: '6'
                  drawtype: BOLD_LINE
                  color: CC6600
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalTxLowThresholdML[{#SNMPINDEX}]'
        -
          name: 'Network Optical Modules Single Lane'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.47.1.1.1.1.8,{#IFTYPE},1.3.6.1.2.1.47.1.1.1.1.2,{#IFNAME},1.3.6.1.2.1.47.1.1.1.1.7,{#TEMPERATURE},1.3.6.1.4.1.2011.5.25.31.1.1.3.1.5]'
          key: net.optical.sl.discovery
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFNAME}'
                value: XG
                formulaid: A
              -
                macro: '{#TEMPERATURE}'
                value: '-255'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          lifetime: 1d
          item_prototypes:
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.32.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneRxPower[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Rx Power do módulo ótico'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
              trigger_prototypes:
                -
                  expression: |
                    ({change()}
                     <= 
                    {$ATTENUATIONFACTOR})
                    
                    and
                    
                    ({last()} <> -40)
                  recovery_mode: NONE
                  name: 'Signal Atenuation on Optical Module SL: {#IFNAME}'
                  status: DISABLED
                  discover: NO_DISCOVER
                  priority: HIGH
                  manual_close: 'YES'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.33.{#SNMPINDEX}'
              key: 'hwEntityOpticalLaneTxPower[{#SNMPINDEX}]'
              delay: 5m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Tx Power do módulo ótico'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
                -
                  type: JAVASCRIPT
                  parameters:
                    - |
                      value = parseFloat(value);
                      value = value.toFixed(2);
                      return value;
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower High Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.14.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxHighThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Limite alto para o Rx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower High Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.21.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxHighWarnThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Limite de alerta alto para Rx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Low Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.13.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxLowThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Limite Baixo para Rx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: RxPower Low Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.20.{#SNMPINDEX}'
              key: 'hwEntityOpticalRxLowWarnThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Limite baixo de alerta para Rx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: Temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.3.1.5.{#SNMPINDEX}'
              key: 'hwEntityOpticalTemperature[{#SNMPINDEX}]'
              delay: 5m
              history: 30d
              value_type: FLOAT
              units: °C
              description: 'Temperatura do módulo ótico'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              trigger_prototypes:
                -
                  expression: |
                    {last()}
                    >=
                    {$TRANSCEIVER_TEMP_WARN}
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: |
                    {last()}
                    <
                    {$TRANSCEIVER_TEMP_WARN}
                  name: 'High Temperature on Optical Module SL: {#IFNAME}'
                  priority: HIGH
                  description: 'Last value: {ITEM.LASTVALUE1}.'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower High Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.16.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxHighThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Limite alto para Tx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower High Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.23.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxHighWarnThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              description: 'Limite de alerta alto para Tx Power'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Low Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.15.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxLowThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: TxPower Low Warning Threshold'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.22.{#SNMPINDEX}'
              key: 'hwEntityOpticalTxLowWarnThreshold[{#SNMPINDEX}]'
              delay: 10m
              history: 10d
              value_type: FLOAT
              units: dBm
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.01'
            -
              name: 'Optical Module Interface {#IFNAME}: Vendor Name'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.24.{#SNMPINDEX}'
              key: 'hwEntityOpticalVenderName[{#SNMPINDEX}]'
              delay: 1h
              history: 30d
              trends: '0'
              value_type: TEXT
              description: 'Fabricante do cabo'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
            -
              name: 'Optical Module Interface {#IFNAME}: Type'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.3.1.25.{#SNMPINDEX}'
              key: 'hwEntityOpticalVenderPn[{#SNMPINDEX}]'
              delay: 1h
              history: 30d
              trends: '0'
              value_type: TEXT
              description: 'Tipo do Cabo'
              application_prototypes:
                -
                  name: 'Transceiver Data Interface SL: {#IFNAME}'
          trigger_prototypes:
            -
              expression: |
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPower[{#SNMPINDEX}].last()}
                 <= 
                ({Template Optical Modules Huawei:hwEntityOpticalRxLowThreshold[{#SNMPINDEX}].last()}))
                and
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPower[{#SNMPINDEX}].last()} <> -40)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPower[{#SNMPINDEX}].last()}
                 >
                ({Template Optical Modules Huawei:hwEntityOpticalRxLowThreshold[{#SNMPINDEX}].last()}))
                and
                ({Template Optical Modules Huawei:hwEntityOpticalLaneRxPower[{#SNMPINDEX}].last()} <> -40)
              name: 'Low Rx Signal on Optical Module SL: {#IFNAME}'
              priority: DISASTER
              description: 'Last value: {ITEM.LASTVALUE1}.'
              manual_close: 'YES'
            -
              expression: |
                ({Template Optical Modules Huawei:hwEntityOpticalLaneTxPower[{#SNMPINDEX}].last()}
                 <= 
                ({Template Optical Modules Huawei:hwEntityOpticalTxLowThreshold[{#SNMPINDEX}].last()}))
                and
                ({Template Optical Modules Huawei:hwEntityOpticalLaneTxPower[{#SNMPINDEX}].last()} <> -40)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                ({Template Optical Modules Huawei:hwEntityOpticalLaneTxPower[{#SNMPINDEX}].last()}
                 >
                ({Template Optical Modules Huawei:hwEntityOpticalTxLowThreshold[{#SNMPINDEX}].last()}))
                and
                ({Template Optical Modules Huawei:hwEntityOpticalLaneTxPower[{#SNMPINDEX}].last()} <> -40)
              name: 'Low Tx Signal on Optical Module SL: {#IFNAME}'
              priority: DISASTER
              description: 'Last value: {ITEM.LASTVALUE1}.'
              manual_close: 'YES'
          graph_prototypes:
            -
              name: 'Optical Module Interface {#IFNAME}: Rx Signals (SL)'
              graph_items:
                -
                  sortorder: '1'
                  color: 59DF00
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalRxHighThreshold[{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: 0040FF
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneRxPower[{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: CC6600
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalRxLowThreshold[{#SNMPINDEX}]'
            -
              name: 'Optical Module Interface {#IFNAME}: Temperature (SL)'
              graph_items:
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: FF0000
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalTemperature[{#SNMPINDEX}]'
            -
              name: 'Optical Module Interface {#IFNAME}: Tx Signals (SL)'
              graph_items:
                -
                  sortorder: '1'
                  color: 59DF00
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalLaneTxPower[{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: 0040FF
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalTxHighThreshold[{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: CC6600
                  item:
                    host: 'Template Optical Modules Huawei'
                    key: 'hwEntityOpticalTxLowThreshold[{#SNMPINDEX}]'
      macros:
        -
          macro: '{$ATTENUATIONFACTOR}'
          value: '-2'
        -
          macro: '{$SNMP_COMMUNITY}'
          value: public
        -
          macro: '{$TRANSCEIVER_TEMP_WARN}'
          value: '80'
