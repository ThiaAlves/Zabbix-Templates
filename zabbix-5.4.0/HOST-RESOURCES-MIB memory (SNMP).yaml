zabbix_export:
  version: '5.4'
  date: '2021-05-28T01:33:08Z'
  groups:
    -
      uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    -
      uuid: a2718bb9168a451fae8fc97486176943
      template: 'HOST-RESOURCES-MIB memory SNMP'
      name: 'HOST-RESOURCES-MIB memory SNMP'
      description: |
        MIBs used:
        HOST-RESOURCES-MIB
        
        Template tooling version used: 0.38
      groups:
        -
          name: Templates/Modules
      discovery_rules:
        -
          uuid: 232e52a9b3df42f2b539c5924edc20c8
          name: 'Memory discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#MEMNAME},1.3.6.1.2.1.25.2.3.1.3,{#MEMTYPE},1.3.6.1.2.1.25.2.3.1.2,{#ALLOC_UNITS},1.3.6.1.2.1.25.2.3.1.4]'
          key: vm.memory.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#MEMTYPE}'
                value: '{$MEMORY.TYPE.MATCHES}'
                formulaid: C
              -
                macro: '{#MEMTYPE}'
                value: '{$MEMORY.TYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              -
                macro: '{#MEMNAME}'
                value: '{$MEMORY.NAME.MATCHES}'
                formulaid: A
              -
                macro: '{#MEMNAME}'
                value: '{$MEMORY.NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          description: 'HOST-RESOURCES-MIB::hrStorage discovery with memory filter'
          item_prototypes:
            -
              uuid: 03d6c47431e74cd8b1d9faf95e9bc756
              name: '{#MEMNAME}: Total memory'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vm.memory.total[hrStorageSize.{#SNMPINDEX}]'
              history: 7d
              units: B
              description: |
                MIB: HOST-RESOURCES-MIB
                The size of the storage represented by this entry, in units of hrStorageAllocationUnits.
                This object is writable to allow remote configuration of the size of the storage area in those cases where such an operation makes sense and is possible on the underlying system.
                For example, the amount of main memory allocated to a buffer pool might be modified or the amount of disk space allocated to virtual memory might be modified.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '{#ALLOC_UNITS}'
              tags:
                -
                  tag: Application
                  value: Memory
            -
              uuid: f5b701faf10d40d596d04e1d921861f9
              name: '{#MEMNAME}: Used memory'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vm.memory.used[hrStorageUsed.{#SNMPINDEX}]'
              history: 7d
              units: B
              description: |
                MIB: HOST-RESOURCES-MIB
                The amount of the storage represented by this entry that is allocated, in units of hrStorageAllocationUnits.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '{#ALLOC_UNITS}'
              tags:
                -
                  tag: Application
                  value: Memory
            -
              uuid: 99961a81ae4a474ea157f108c8014c77
              name: '{#MEMNAME}: Memory utilization'
              type: CALCULATED
              key: 'vm.memory.util[memoryUsedPercentage.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: '%'
              params: 'last(//vm.memory.used[hrStorageUsed.{#SNMPINDEX}])/last(//vm.memory.total[hrStorageSize.{#SNMPINDEX}])*100'
              description: 'Memory utilization in %'
              tags:
                -
                  tag: Application
                  value: Memory
              trigger_prototypes:
                -
                  uuid: 7ecb1ea2693a49c595a47acfa9ab4a3a
                  expression: 'min(/HOST-RESOURCES-MIB memory SNMP/vm.memory.util[memoryUsedPercentage.{#SNMPINDEX}],5m)>{$MEMORY.UTIL.MAX}'
                  name: '{#MEMNAME}: High memory utilization ( >{$MEMORY.UTIL.MAX}% for 5m)'
                  priority: AVERAGE
                  description: |
                    The system is running out of free memory.
                    Last value: {ITEM.LASTVALUE1}.
          graph_prototypes:
            -
              uuid: 47a47f92e42047fe937e01ad163ca665
              name: '{#MEMNAME}: Memory utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: 'HOST-RESOURCES-MIB memory SNMP'
                    key: 'vm.memory.util[memoryUsedPercentage.{#SNMPINDEX}]'
      macros:
        -
          macro: '{$MEMORY.NAME.MATCHES}'
          value: '.*'
          description: 'This macro is used in memory discovery. Can be overridden on the host or linked template level.'
        -
          macro: '{$MEMORY.NAME.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'This macro is used in memory discovery. Can be overridden on the host or linked template level if you need to filter out results.'
        -
          macro: '{$MEMORY.TYPE.MATCHES}'
          value: '.*(\.2|hrStorageRam)$'
          description: 'This macro is used in memory discovery. Can be overridden on the host or linked template level.'
        -
          macro: '{$MEMORY.TYPE.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'This macro is used in memory discovery. Can be overridden on the host or linked template level if you need to filter out results.'
        -
          macro: '{$MEMORY.UTIL.MAX}'
          value: '90'
          description: 'The warning threshold of the "Physical memory: Memory utilization" item.'
