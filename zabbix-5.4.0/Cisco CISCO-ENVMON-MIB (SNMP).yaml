zabbix_export:
  version: '5.4'
  date: '2021-05-28T01:00:22Z'
  groups:
    -
      uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    -
      uuid: 51af5cf9312b41d38ab22e02c9af6bbc
      template: 'Cisco CISCO-ENVMON-MIB SNMP'
      name: 'Cisco CISCO-ENVMON-MIB SNMP'
      description: |
        Template Cisco CISCO-ENVMON-MIB
        
        MIBs used:
        CISCO-ENVMON-MIB
        
        Template tooling version used: 0.38
      groups:
        -
          name: Templates/Modules
      discovery_rules:
        -
          uuid: 31e5f90d88574fa0a35664e2c6b51e98
          name: 'FAN Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SENSOR_INFO},1.3.6.1.4.1.9.9.13.1.4.1.2]'
          key: fan.discovery
          delay: 1h
          description: 'The table of fan status maintained by the environmental monitor.'
          item_prototypes:
            -
              uuid: 62a05225a1634d7486fab92cf100544e
              name: '{#SENSOR_INFO}: Fan status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.13.1.4.1.3.{#SNMPINDEX}'
              key: 'sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}]'
              delay: 3m
              history: 2w
              trends: '0'
              description: |
                MIB: CISCO-ENVMON-MIB.
                Status da Fan
              valuemap:
                name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
              tags:
                -
                  tag: Application
                  value: Fans
              trigger_prototypes:
                -
                  uuid: a9f5e9e2a65143298910e354e832bf2f
                  expression: 'count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#1,"eq","{$FAN_CRIT_STATUS:\"critical\"}")=1 or count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#1,"eq","{$FAN_CRIT_STATUS:\"shutdown\"}")=1'
                  name: '{#SENSOR_INFO}: Fan is in critical state'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    Please check the fan unit.
                    Last value: {ITEM.LASTVALUE1}.
                -
                  uuid: 58cf2c24afd74e5cb048557e8e52138e
                  expression: 'count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#1,"eq","{$FAN_WARN_STATUS:\"warning\"}")=1 or count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#1,"eq","{$FAN_WARN_STATUS:\"notFunctioning\"}")=1'
                  name: '{#SENSOR_INFO}: Fan is in warning state'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Please check the fan unit.
                    Last value: {ITEM.LASTVALUE1}.
                  dependencies:
                    -
                      name: '{#SENSOR_INFO}: Fan is in critical state'
                      expression: 'count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#1,"eq","{$FAN_CRIT_STATUS:\"critical\"}")=1 or count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#1,"eq","{$FAN_CRIT_STATUS:\"shutdown\"}")=1'
        -
          uuid: 932817396a5b47f29af28e439711ef59
          name: 'PSU Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SENSOR_INFO},1.3.6.1.4.1.9.9.13.1.5.1.2]'
          key: psu.discovery
          delay: 1h
          description: 'The table of power supply status maintained by the environmental monitor card.'
          item_prototypes:
            -
              uuid: d500235d63ca41888585d267a7d82e2a
              name: '{#SENSOR_INFO}: Power supply status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.13.1.5.1.3.{#SNMPINDEX}'
              key: 'sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}]'
              delay: 3m
              history: 2w
              trends: '0'
              description: |
                MIB: CISCO-ENVMON-MIB.
                Status da fonte de energia
              valuemap:
                name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
              tags:
                -
                  tag: Application
                  value: 'Power supply'
              trigger_prototypes:
                -
                  uuid: 5796e1e85ea949d0b86ce83f5daae958
                  expression: 'count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#1,"eq","{$PSU_CRIT_STATUS:\"critical\"}")=1 or count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#1,"eq","{$PSU_CRIT_STATUS:\"shutdown\"}")=1'
                  name: '{#SENSOR_INFO}: Power supply is in critical state'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    Please check the power supply unit for errors.
                    Last value: {ITEM.LASTVALUE1}.
                -
                  uuid: 93892fed243f4f0b8c26ab67fa6e1800
                  expression: 'count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#1,"eq","{$PSU_WARN_STATUS:\"warning\"}")=1 or count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#1,"eq","{$PSU_WARN_STATUS:\"notFunctioning\"}")=1'
                  name: '{#SENSOR_INFO}: Power supply is in warning state'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Please check the power supply unit for errors.
                    Last value: {ITEM.LASTVALUE1}.
                  dependencies:
                    -
                      name: '{#SENSOR_INFO}: Power supply is in critical state'
                      expression: 'count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#1,"eq","{$PSU_CRIT_STATUS:\"critical\"}")=1 or count(/Cisco CISCO-ENVMON-MIB SNMP/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#1,"eq","{$PSU_CRIT_STATUS:\"shutdown\"}")=1'
        -
          uuid: e61bb682818b4f31a669acd31335160c
          name: 'Temperature Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.13.1.3.1.2]'
          key: temperature.discovery
          delay: 1h
          description: |
            Discovery of ciscoEnvMonTemperatureTable (ciscoEnvMonTemperatureDescr), a table of ambient temperature status
            maintained by the environmental monitor.
          item_prototypes:
            -
              uuid: 72f0970a636d44278b75f30a1dabfeb8
              name: '{#SNMPVALUE}: Temperature status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.13.1.3.1.6.{#SNMPINDEX}'
              key: 'sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}]'
              delay: 3m
              history: 2w
              trends: 0d
              description: |
                MIB: CISCO-ENVMON-MIB
                The current state of the test point being instrumented.
              valuemap:
                name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
              tags:
                -
                  tag: Application
                  value: Temperature
            -
              uuid: 4859221e53d7485485db1c9060d7f705
              name: '{#SNMPVALUE}: Temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.13.1.3.1.3.{#SNMPINDEX}'
              key: 'sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}]'
              delay: 3m
              value_type: FLOAT
              units: Â°C
              description: |
                MIB: CISCO-ENVMON-MIB
                The current measurement of the test point being instrumented.
              tags:
                -
                  tag: Application
                  value: Temperature
              trigger_prototypes:
                -
                  uuid: 2bb01154728b47c69514f7399f3bfabc
                  expression: 'avg(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_CRIT_LOW:"{#SNMPVALUE}"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'min(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_CRIT_LOW:"{#SNMPVALUE}"}+3'
                  name: '{#SNMPVALUE}: Temperature is too low: <{$TEMP_CRIT_LOW:"{#SNMPVALUE}"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Last value: {ITEM.LASTVALUE1}.'
          trigger_prototypes:
            -
              uuid: f356f7fbc2de423db3bac09bc4683ae2
              expression: |
                avg(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SNMPVALUE}"}
                or
                last(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_CRIT_STATUS}
                or
                last(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_DISASTER_STATUS}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'max(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"{#SNMPVALUE}"}-3'
              name: '{#SNMPVALUE}: Temperature is above critical threshold: >{$TEMP_CRIT:"{#SNMPVALUE}"}'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: HIGH
              description: |
                This trigger uses temperature sensor values as well as temperature sensor status if available.
                Last value: {ITEM.LASTVALUE1}.
            -
              uuid: 2c151dd93b7f4096b9eb6c73c315ffec
              expression: |
                avg(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_WARN:"{#SNMPVALUE}"}
                or
                last(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_WARN_STATUS}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'max(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_WARN:"{#SNMPVALUE}"}-3'
              name: '{#SNMPVALUE}: Temperature is above warning threshold: >{$TEMP_WARN:"{#SNMPVALUE}"}'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: |
                This trigger uses temperature sensor values as well as temperature sensor status if available.
                Last value: {ITEM.LASTVALUE1}.
              dependencies:
                -
                  name: '{#SNMPVALUE}: Temperature is above critical threshold: >{$TEMP_CRIT:"{#SNMPVALUE}"}'
                  expression: |
                    avg(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SNMPVALUE}"}
                    or
                    last(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_CRIT_STATUS}
                    or
                    last(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_DISASTER_STATUS}
                  recovery_expression: 'max(/Cisco CISCO-ENVMON-MIB SNMP/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"{#SNMPVALUE}"}-3'
      macros:
        -
          macro: '{$FAN_CRIT_STATUS:"critical"}'
          value: '3'
        -
          macro: '{$FAN_CRIT_STATUS:"shutdown"}'
          value: '4'
        -
          macro: '{$FAN_WARN_STATUS:"notFunctioning"}'
          value: '6'
        -
          macro: '{$FAN_WARN_STATUS:"warning"}'
          value: '2'
        -
          macro: '{$PSU_CRIT_STATUS:"critical"}'
          value: '3'
        -
          macro: '{$PSU_CRIT_STATUS:"shutdown"}'
          value: '4'
        -
          macro: '{$PSU_WARN_STATUS:"notFunctioning"}'
          value: '6'
        -
          macro: '{$PSU_WARN_STATUS:"warning"}'
          value: '2'
        -
          macro: '{$TEMP_CRIT}'
          value: '60'
        -
          macro: '{$TEMP_CRIT:"CPU"}'
          value: '75'
        -
          macro: '{$TEMP_CRIT_LOW}'
          value: '5'
        -
          macro: '{$TEMP_CRIT_STATUS}'
          value: '3'
        -
          macro: '{$TEMP_DISASTER_STATUS}'
          value: '4'
        -
          macro: '{$TEMP_WARN}'
          value: '50'
        -
          macro: '{$TEMP_WARN:"CPU"}'
          value: '70'
        -
          macro: '{$TEMP_WARN_STATUS}'
          value: '2'
      valuemaps:
        -
          uuid: 96da9a43fa60420696714c57d3e72f13
          name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
          mappings:
            -
              value: '1'
              newvalue: normal
            -
              value: '2'
              newvalue: warning
            -
              value: '3'
              newvalue: critical
            -
              value: '4'
              newvalue: shutdown
            -
              value: '5'
              newvalue: notPresent
            -
              value: '6'
              newvalue: notFunctioning
