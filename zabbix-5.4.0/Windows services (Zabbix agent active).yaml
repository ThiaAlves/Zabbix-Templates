zabbix_export:
  version: '5.4'
  date: '2021-05-28T04:02:14Z'
  groups:
    -
      uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    -
      uuid: 3366a65bbc3e46348bec303e84e23b15
      template: 'Windows services by Zabbix agent active'
      name: 'Windows services by Zabbix agent active'
      description: |
        Template Services OS Windows
        
        Template tooling version used: 0.38
      groups:
        -
          name: Templates/Modules
      discovery_rules:
        -
          uuid: 25e19e75eb4d4fd68df976323c7fac21
          name: 'Windows services discovery'
          type: ZABBIX_ACTIVE
          key: service.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SERVICE.NAME}'
                value: '{$SERVICE.NAME.MATCHES}'
                formulaid: A
              -
                macro: '{#SERVICE.NAME}'
                value: '{$SERVICE.NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              -
                macro: '{#SERVICE.STARTUPNAME}'
                value: '{$SERVICE.STARTUPNAME.MATCHES}'
                formulaid: C
              -
                macro: '{#SERVICE.STARTUPNAME}'
                value: '{$SERVICE.STARTUPNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
          description: 'Discovery of Windows services of different types as defined in template''s macros.'
          item_prototypes:
            -
              uuid: c1606f1f7c9e4eb494c0c5e4e4f21ea5
              name: 'State of service "{#SERVICE.NAME}" ({#SERVICE.DISPLAYNAME})'
              type: ZABBIX_ACTIVE
              key: 'service.info["{#SERVICE.NAME}",state]'
              history: 7d
              valuemap:
                name: 'Windows service state'
              tags:
                -
                  tag: Application
                  value: Services
              trigger_prototypes:
                -
                  uuid: df3247515e2e4b48b2decd8401c11736
                  expression: 'min(/Windows services by Zabbix agent active/service.info["{#SERVICE.NAME}",state],#3)<>0'
                  name: '"{#SERVICE.NAME}" ({#SERVICE.DISPLAYNAME}) is not running (startup type {#SERVICE.STARTUPNAME})'
                  priority: AVERAGE
                  description: |
                    The service has a state other than "Running" for the last three times.
                    Last value: {ITEM.LASTVALUE1}.
      macros:
        -
          macro: '{$SERVICE.NAME.MATCHES}'
          value: '^.*$'
          description: 'This macro is used in Service discovery. Can be overridden on the host or linked template level.'
        -
          macro: '{$SERVICE.NAME.NOT_MATCHES}'
          value: '^RemoteRegistry|MMCSS|gupdate|SysmonLog|clr_optimization_v.+|clr_optimization_v.+|sppsvc|gpsvc|Pml Driver HPZ12|Net Driver HPZ12|MapsBroker|IntelAudioService|Intel\(R\) TPM Provisioning Service|dbupdate|DoSvc$'
          description: 'This macro is used in Service discovery. Can be overridden on the host or linked template level.'
        -
          macro: '{$SERVICE.STARTUPNAME.MATCHES}'
          value: '^automatic|automatic delayed$'
          description: 'This macro is used in Service discovery. Can be overridden on the host or linked template level.'
        -
          macro: '{$SERVICE.STARTUPNAME.NOT_MATCHES}'
          value: ^manual|disabled$
          description: 'This macro is used in Service discovery. Can be overridden on the host or linked template level.'
      valuemaps:
        -
          uuid: af7bd46d70ed4058afa4961d130dc0b2
          name: 'Windows service state'
          mappings:
            -
              value: '0'
              newvalue: Running
            -
              value: '1'
              newvalue: Paused
            -
              value: '3'
              newvalue: 'Pause pending'
            -
              value: '4'
              newvalue: 'Continue pending'
            -
              value: '5'
              newvalue: 'Stop pending'
            -
              value: '6'
              newvalue: Stopped
            -
              value: '7'
              newvalue: Unknown
            -
              value: '255'
              newvalue: 'No such service'
            -
              value: '2'
              newvalue: 'Start pending'
